<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CodeCoverageDashboard.Pages.StaticDashboardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:models="clr-namespace:CodeCoverageDashboard.Models"
    xmlns:telerik="http://schemas.telerik.com/2022/xaml/maui"
    xmlns:viewmodels="clr-namespace:CodeCoverageDashboard.ViewModels"
    Title="StaticDashboardPage"
    x:DataType="viewmodels:StaticDashboardPageViewModel"
    Shell.NavBarIsVisible="False">
    <Grid ColumnDefinitions="*" RowDefinitions="*,auto,*">
        <!--  Row 1  -->
        <Grid ColumnDefinitions="*, *, *" RowDefinitions="*">
            <!--  Lines Covered Graph  -->
            <Grid RowDefinitions="auto, *">
                <Label
                    Grid.Row="0"
                    Style="{StaticResource labelSubHeading}"
                    Text="Lines Covered">
                    <Label.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding GoToMainPageCommand}" NumberOfTapsRequired="2" />
                    </Label.GestureRecognizers>
                </Label>

                <telerik:RadCartesianChart Grid.Row="1">

                    <telerik:RadCartesianChart.HorizontalAxis>
                        <telerik:DateTimeContinuousAxis MajorStep="2" MajorStepUnit="Week" />
                    </telerik:RadCartesianChart.HorizontalAxis>

                    <telerik:RadCartesianChart.VerticalAxis>
                        <telerik:NumericalAxis MajorStep="2500" Minimum="0" />
                    </telerik:RadCartesianChart.VerticalAxis>

                    <telerik:RadCartesianChart.Series>
                        <telerik:LineSeries
                            CategoryBinding="DateRetrieved"
                            ItemsSource="{Binding Data}"
                            ValueBinding="TotalLinesCoveredCount" />
                    </telerik:RadCartesianChart.Series>

                </telerik:RadCartesianChart>
            </Grid>
            <!--  Code Coverage Graph  -->
            <Grid Grid.Column="1" RowDefinitions="auto, *">
                <Label
                    Grid.Row="0"
                    Style="{StaticResource labelSubHeading}"
                    Text="Line Coverage Percent" />
                <telerik:RadCartesianChart Grid.Row="1">

                    <telerik:RadCartesianChart.HorizontalAxis>
                        <telerik:DateTimeContinuousAxis MajorStep="2" MajorStepUnit="Week" />
                    </telerik:RadCartesianChart.HorizontalAxis>

                    <telerik:RadCartesianChart.VerticalAxis>
                        <telerik:NumericalAxis
                            LabelFormat="P2"
                            MajorStep="0.25"
                            Maximum="1"
                            Minimum="0" />
                    </telerik:RadCartesianChart.VerticalAxis>

                    <telerik:RadCartesianChart.Series>
                        <telerik:LineSeries
                            CategoryBinding="DateRetrieved"
                            ItemsSource="{Binding Data}"
                            ValueBinding="AverageLineCoveragePercent" />
                    </telerik:RadCartesianChart.Series>

                </telerik:RadCartesianChart>
            </Grid>
            <!--  General Information Border  -->
            <telerik:RadBorder Grid.Column="2" Style="{StaticResource borderRoundedStyle}">
                <Grid ColumnDefinitions="*, *" RowDefinitions="*, *, *, *, *, *, *, auto">
                    <!--  Heading  -->
                    <Label
                        Grid.Row="0"
                        Grid.ColumnSpan="2"
                        Padding="5"
                        Style="{StaticResource labelHeading}"
                        Text="Code Coverage Dashboard">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding GetRepoDataCommand}" NumberOfTapsRequired="2" />
                        </Label.GestureRecognizers>
                    </Label>

                    <!--  Total Number of Repos  -->
                    <Label
                        Grid.Row="1"
                        Grid.Column="0"
                        Style="{StaticResource labelBody}"
                        Text="Total Number of Repos:" />
                    <Label
                        Grid.Row="1"
                        Grid.Column="1"
                        Style="{StaticResource labelBodyRightAlign}"
                        Text="{Binding LatestData.TotalReposCount}" />

                    <!--  Total Number of Classes  -->
                    <Label
                        Grid.Row="2"
                        Grid.Column="0"
                        Style="{StaticResource labelBody}"
                        Text="Total Number of Classes:" />
                    <Label
                        Grid.Row="2"
                        Grid.Column="1"
                        Style="{StaticResource labelBodyRightAlign}"
                        Text="{Binding LatestData.TotalClassesCount}" />

                    <!--  Total Number of Methods  -->
                    <Label
                        Grid.Row="3"
                        Grid.Column="0"
                        Style="{StaticResource labelBody}"
                        Text="Total Number of Methods:" />
                    <Label
                        Grid.Row="3"
                        Grid.Column="1"
                        Style="{StaticResource labelBodyRightAlign}"
                        Text="{Binding LatestData.TotalMethodsCount}" />

                    <!--  Total Number of Lines  -->
                    <Label
                        Grid.Row="4"
                        Grid.Column="0"
                        Style="{StaticResource labelBody}"
                        Text="Total Number of Lines:" />
                    <Label
                        Grid.Row="4"
                        Grid.Column="1"
                        Style="{StaticResource labelBodyRightAlign}"
                        Text="{Binding LatestData.TotalLinesCount}" />

                    <!--  Date Retrieved  -->
                    <Label
                        Grid.Row="5"
                        Grid.Column="0"
                        Style="{StaticResource labelBody}"
                        Text="Date Retrieved:" />
                    <Label
                        Grid.Row="5"
                        Grid.Column="1"
                        Style="{StaticResource labelBodyRightAlign}"
                        Text="{Binding LatestData.DateRetrieved}" />

                    <Label
                        Grid.Row="6"
                        Grid.ColumnSpan="2"
                        FontSize="18"
                        HorizontalTextAlignment="Center"
                        VerticalOptions="End">
                        <Label.Text>
                            <MultiBinding StringFormat="Dashboard Version: {0} | Coverlet Version: {1} | By Cameron Strachan">
                                <Binding Path="LatestData.CoverletVersion" />
                                <Binding Path="LatestData.DashboardVersion" />
                            </MultiBinding>
                        </Label.Text>
                    </Label>
                </Grid>
            </telerik:RadBorder>
        </Grid>
        <!--  Row 2  -->
        <Grid Grid.Row="1" ColumnDefinitions="*, *">
            <Grid Grid.Column="0" RowDefinitions="auto, *">
                <Label
                    Grid.Row="0"
                    Style="{StaticResource labelSubHeading}"
                    Text="Hot Repos ðŸ”¥ðŸ”¥ðŸ”¥" />
                <telerik:RadDataGrid
                    Grid.Row="1"
                    AlternateRowBackgroundStyle="{StaticResource datagridAlternateRowBackground}"
                    ItemsSource="{Binding Top5Hottest}"
                    RowBackgroundStyle="{StaticResource datagridRowBackground}"
                    Style="{StaticResource datagridBase}">

                    <telerik:RadDataGrid.Columns>
                        <telerik:DataGridTextColumn
                            CellContentStyle="{StaticResource datagridCellContentBase}"
                            HeaderStyle="{StaticResource datagridHeaderBase}"
                            HeaderText="Repository Name"
                            PropertyName="Name"
                            Style="{StaticResource datagridColoumnStretch}" />



                        <telerik:DataGridTemplateColumn
                            HeaderStyle="{StaticResource datagridHeaderRightAlign}"
                            HeaderText="Percent Increase"
                            Style="{StaticResource datagridColoumnAuto}">

                            <telerik:DataGridTemplateColumn.CellContentTemplate>
                                <DataTemplate x:DataType="models:RepoData">
                                    <Grid
                                        Margin="0,0,5,0"
                                        ColumnDefinitions="Auto, *"
                                        ColumnSpacing="10"
                                        HorizontalOptions="End"
                                        VerticalOptions="Center"
                                        WidthRequest="70">
                                        <Image
                                            Grid.Column="0"
                                            Source="green_arrow_up.png"
                                            Style="{StaticResource imageEmoji}" />
                                        <Label
                                            Grid.Column="1"
                                            Style="{StaticResource labelBodyRightAlign}"
                                            Text="{Binding CoveragePercentPercentIncrease, StringFormat='{}{0}%'}"
                                            VerticalOptions="Center"
                                            VerticalTextAlignment="Center" />
                                    </Grid>
                                </DataTemplate>
                            </telerik:DataGridTemplateColumn.CellContentTemplate>
                        </telerik:DataGridTemplateColumn>

                        <telerik:DataGridTemplateColumn
                            HeaderStyle="{StaticResource datagridHeaderRightAlign}"
                            HeaderText="Lines Increase"
                            Style="{StaticResource datagridColoumnAuto}">

                            <telerik:DataGridTemplateColumn.CellContentTemplate>
                                <DataTemplate x:DataType="models:RepoData">
                                    <Grid
                                        Margin="0,0,5,0"
                                        ColumnDefinitions="Auto, *"
                                        ColumnSpacing="10"
                                        HorizontalOptions="End"
                                        VerticalOptions="Center"
                                        WidthRequest="70">
                                        <Image
                                            Grid.Column="0"
                                            Source="green_arrow_up.png"
                                            Style="{StaticResource imageEmoji}" />
                                        <Label
                                            Grid.Column="1"
                                            HorizontalOptions="End"
                                            HorizontalTextAlignment="End"
                                            Style="{StaticResource labelBodyRightAlign}"
                                            Text="{Binding CoveredLinesIncrease}"
                                            VerticalOptions="Center" />
                                    </Grid>
                                </DataTemplate>
                            </telerik:DataGridTemplateColumn.CellContentTemplate>
                        </telerik:DataGridTemplateColumn>

                    </telerik:RadDataGrid.Columns>

                    <telerik:RadDataGrid.SortDescriptors>
                        <telerik:PropertySortDescriptor PropertyName="CoveragePercentPercentIncrease" SortOrder="Descending" />
                    </telerik:RadDataGrid.SortDescriptors>
                </telerik:RadDataGrid>
            </Grid>

            <Grid Grid.Column="1" RowDefinitions="auto, *">
                <Label
                    Grid.Row="0"
                    Style="{StaticResource labelSubHeading}"
                    Text="Complex Methods ðŸ˜µâ€ðŸ’«ðŸ˜µâ€ðŸ’«ðŸ˜µâ€ðŸ’«" />

                <telerik:RadDataGrid
                    Grid.Row="1"
                    AlternateRowBackgroundStyle="{StaticResource datagridAlternateRowBackground}"
                    ItemsSource="{Binding Top5Complex}"
                    RowBackgroundStyle="{StaticResource datagridRowBackground}"
                    Style="{StaticResource datagridBase}">

                    <telerik:RadDataGrid.Columns>
                        <telerik:DataGridTextColumn
                            CellContentStyle="{StaticResource datagridCellContentBase}"
                            HeaderStyle="{StaticResource datagridHeaderBase}"
                            HeaderText="Method Name"
                            PropertyName="Name"
                            Style="{StaticResource datagridColoumnStretch}" />
                        <telerik:DataGridNumericalColumn
                            CellContentStyle="{StaticResource datagridCellContentRightAlign}"
                            HeaderStyle="{StaticResource datagridHeaderRightAlign}"
                            HeaderText="Complexity"
                            PropertyName="Complexity"
                            Style="{StaticResource datagridColoumnAuto}" />
                    </telerik:RadDataGrid.Columns>

                    <telerik:RadDataGrid.SortDescriptors>
                        <telerik:PropertySortDescriptor PropertyName="Complexity" SortOrder="Descending" />
                    </telerik:RadDataGrid.SortDescriptors>
                </telerik:RadDataGrid>

            </Grid>
        </Grid>

        <Grid
            Grid.Row="2"
            ColumnDefinitions="*, *, *"
            RowDefinitions="*">

            <Grid Grid.Column="0" RowDefinitions="auto, *">
                <Label Style="{StaticResource labelSubHeading}" Text="Line Coverage" />

                <Label
                    Grid.Row="1"
                    Margin="5,0,0,100"
                    HorizontalOptions="Center"
                    Style="{StaticResource labelEmphasis}"
                    Text="{Binding LatestData.AverageLineCoveragePercent, StringFormat='{}{0:P2}'}"
                    VerticalOptions="End" />
                <Label
                    Grid.Row="1"
                    Margin="5,0,0,80"
                    HorizontalOptions="Center"
                    Style="{StaticResource labelBody}"
                    Text="{Binding LatestData.TotalLinesCoveredCount, StringFormat='({0})'}"
                    VerticalOptions="End" />
                <telerik:RadRadialGauge Grid.Row="1">
                    <telerik:RadRadialGauge.Axis>
                        <telerik:GaugeLinearAxis
                            Maximum="1"
                            Minimum="0"
                            Step="0.1" />
                    </telerik:RadRadialGauge.Axis>

                    <telerik:RadRadialGauge.Ranges>
                        <telerik:GaugeRangesDefinition>
                            <telerik:GaugeGradientRange From="0" To="1">
                                <telerik:RadGradientStop Offset="0.9" Color="Green" />
                                <telerik:RadGradientStop Offset="0.8" Color="GreenYellow" />
                                <telerik:RadGradientStop Offset="0.67" Color="Yellow" />
                                <telerik:RadGradientStop Offset="0.5" Color="Orange" />
                                <telerik:RadGradientStop Offset="0.1" Color="Red" />
                                <telerik:RadGradientStop Offset="0" Color="Red" />
                            </telerik:GaugeGradientRange>
                        </telerik:GaugeRangesDefinition>
                    </telerik:RadRadialGauge.Ranges>

                    <telerik:RadRadialGauge.Indicators>
                        <telerik:GaugeNeedleIndicator Offset="0" Value="{Binding LatestData.AverageLineCoveragePercent}" />
                    </telerik:RadRadialGauge.Indicators>

                </telerik:RadRadialGauge>

            </Grid>

            <Grid Grid.Column="1" RowDefinitions="auto, *">

                <Label Style="{StaticResource labelSubHeading}" Text="Branch Coverage" />

                <Label
                    Grid.Row="1"
                    Margin="5,0,0,100"
                    HorizontalOptions="Center"
                    Style="{StaticResource labelEmphasis}"
                    Text="{Binding LatestData.AverageBranchCoveragePercent, StringFormat='{}{0:P2}'}"
                    VerticalOptions="End" />
                <Label
                    Grid.Row="1"
                    Margin="5,0,0,80"
                    HorizontalOptions="Center"
                    Style="{StaticResource labelBody}"
                    Text="{Binding LatestData.TotalBracnhesCoveredCount, StringFormat='({0})'}"
                    VerticalOptions="End" />
                <telerik:RadRadialGauge Grid.Row="1">
                    <telerik:RadRadialGauge.Axis>
                        <telerik:GaugeLinearAxis
                            Maximum="1"
                            Minimum="0"
                            Step="0.1" />
                    </telerik:RadRadialGauge.Axis>

                    <telerik:RadRadialGauge.Ranges>
                        <telerik:GaugeRangesDefinition>
                            <telerik:GaugeGradientRange From="0" To="1">
                                <telerik:RadGradientStop Offset="0.9" Color="Green" />
                                <telerik:RadGradientStop Offset="0.8" Color="GreenYellow" />
                                <telerik:RadGradientStop Offset="0.67" Color="Yellow" />
                                <telerik:RadGradientStop Offset="0.5" Color="Orange" />
                                <telerik:RadGradientStop Offset="0.1" Color="Red" />
                                <telerik:RadGradientStop Offset="0" Color="Red" />
                            </telerik:GaugeGradientRange>
                        </telerik:GaugeRangesDefinition>
                    </telerik:RadRadialGauge.Ranges>

                    <telerik:RadRadialGauge.Indicators>
                        <telerik:GaugeNeedleIndicator Value="{Binding LatestData.AverageBranchCoveragePercent}" />
                    </telerik:RadRadialGauge.Indicators>

                </telerik:RadRadialGauge>

            </Grid>

            <Grid Grid.Column="2" RowDefinitions="auto, *">

                <Label Style="{StaticResource labelSubHeading}" Text="Complex Methods" />

                <Label
                    Grid.Row="1"
                    Margin="5,0,0,100"
                    HorizontalOptions="Center"
                    Style="{StaticResource labelEmphasis}"
                    Text="{Binding LatestData.AverageComplexMethodPercent, StringFormat='{}{0:P2}'}"
                    VerticalOptions="End" />
                <Label
                    Grid.Row="1"
                    Margin="5,0,0,80"
                    HorizontalOptions="Center"
                    Style="{StaticResource labelBody}"
                    Text="{Binding LatestData.TotalComplexMethodCount, StringFormat='({0})'}"
                    VerticalOptions="End" />
                <telerik:RadRadialGauge Grid.Row="1">

                    <telerik:RadRadialGauge.Axis>
                        <telerik:GaugeLinearAxis
                            Maximum="1"
                            Minimum="0"
                            Step="0.1" />
                    </telerik:RadRadialGauge.Axis>

                    <telerik:RadRadialGauge.Ranges>
                        <telerik:GaugeRangesDefinition>
                            <telerik:GaugeGradientRange From="0" To="1">
                                <telerik:RadGradientStop Offset="0.005" Color="Green" />
                                <telerik:RadGradientStop Offset="0.05" Color="GreenYellow" />
                                <telerik:RadGradientStop Offset="0.1" Color="Yellow" />
                                <telerik:RadGradientStop Offset="0.4" Color="Orange" />
                                <telerik:RadGradientStop Offset="0.5" Color="Red" />
                                <telerik:RadGradientStop Offset="1" Color="Red" />
                            </telerik:GaugeGradientRange>
                        </telerik:GaugeRangesDefinition>
                    </telerik:RadRadialGauge.Ranges>

                    <telerik:RadRadialGauge.Indicators>
                        <telerik:GaugeNeedleIndicator Offset="0" Value="{Binding LatestData.AverageComplexMethodPercent, Converter={StaticResource InvertPercentConverter}}" />
                    </telerik:RadRadialGauge.Indicators>

                </telerik:RadRadialGauge>

            </Grid>

        </Grid>

    </Grid>
</ContentPage>