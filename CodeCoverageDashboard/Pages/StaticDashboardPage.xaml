<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CodeCoverageDashboard.Pages.StaticDashboardPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
    xmlns:models="clr-namespace:CodeCoverageDashboard.Models"
    xmlns:progressBar="clr-namespace:Syncfusion.Maui.ProgressBar;assembly=Syncfusion.Maui.ProgressBar"
    xmlns:table="clr-namespace:Syncfusion.Maui.DataGrid;assembly=Syncfusion.Maui.DataGrid"
    xmlns:viewmodels="clr-namespace:CodeCoverageDashboard.ViewModels"
    Title="StaticDashboardPage"
    x:DataType="viewmodels:StaticDashboardPageViewModel">
    <Grid ColumnDefinitions="*" RowDefinitions="*,*,*">

        <Grid ColumnDefinitions="*, *, *" RowDefinitions="*">
            <chart:SfCartesianChart Title="Lines Covered" Grid.Column="0">

                <chart:SfCartesianChart.XAxes>
                    <chart:DateTimeAxis />
                </chart:SfCartesianChart.XAxes>
                <chart:SfCartesianChart.YAxes>
                    <chart:NumericalAxis />
                </chart:SfCartesianChart.YAxes>


                <chart:LineSeries
                    ItemsSource="{Binding Data}"
                    XBindingPath="DateRetrieved"
                    YBindingPath="TotalLinesCoveredCount" />
            </chart:SfCartesianChart>

            <chart:SfCartesianChart Title="Line Coverage Percentage" Grid.Column="1">

                <chart:SfCartesianChart.XAxes>
                    <chart:DateTimeAxis />
                </chart:SfCartesianChart.XAxes>
                <chart:SfCartesianChart.YAxes>
                    <chart:NumericalAxis
                        Maximum="1"
                        Minimum="0"
                        MinorTicksPerInterval="4" />
                </chart:SfCartesianChart.YAxes>


                <chart:LineSeries
                    ItemsSource="{Binding Data}"
                    XBindingPath="DateRetrieved"
                    YBindingPath="AverageLineCoveragePercent" />
            </chart:SfCartesianChart>

            <Border
                Grid.Column="2"
                Margin="10"
                Padding="5"
                Stroke="Black"
                StrokeThickness="2">
                <VerticalStackLayout>
                    <Label FontSize="Large" Text="Code Coverage Dashboard" />
                    <Label Text="{Binding LatestData.TotalReposCount, StringFormat='Total Number of Repos: {0}'}" />
                    <Label Text="{Binding LatestData.TotalClassesCount, StringFormat='Total Number of Classes: {0}'}" />
                    <Label Text="{Binding LatestData.TotalMethodsCount, StringFormat='Total Number of Methods: {0}'}" />
                    <Label Text="{Binding LatestData.TotalLinesCount, StringFormat='Total Number of Lines: {0}'}" />
                    <Label Text="{Binding LatestData.CoverletVersion, StringFormat='Coverlet Version: {0}'}" />
                    <Label Text="{Binding LatestData.DashboardVersion, StringFormat='Dashboard Version: {0}'}" />

                </VerticalStackLayout>
            </Border>


        </Grid>
        <Grid
            Grid.Row="1"
            ColumnDefinitions="*, *"
            RowDefinitions="2000">
            <VerticalStackLayout Grid.Column="0" Padding="5">
                <Label
                    FontSize="Large"
                    HorizontalOptions="Center"
                    Text="Hot Repos ðŸ”¥ðŸ”¥ðŸ”¥" />
                <table:SfDataGrid
                    AutoGenerateColumnsMode="None"
                    ColumnWidthMode="Fill"
                    HorizontalOptions="Fill"
                    ItemsSource="{Binding LatestData.HotRepos}"
                    RowHeight="43">

                    <table:SfDataGrid.DefaultStyle>
                        <table:DataGridStyle
                            AlternateRowBackground="White"
                            HeaderRowBackground="#d3d3d3"
                            HeaderRowFontSize="20"
                            RowBackground="#e6e6e6" />
                    </table:SfDataGrid.DefaultStyle>

                    <table:SfDataGrid.Columns>
                        <table:DataGridTextColumn HeaderText="Repo Name" MappingName="Name" />
                        <table:DataGridTemplateColumn
                            Width="200"
                            HeaderText="Coverage Percent Increase"
                            MappingName="CoveragePercentPercentIncrease">
                            <table:DataGridTemplateColumn.CellTemplate>
                                <DataTemplate x:DataType="models:RepoData">
                                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                                        <Label Text="{Binding CoveragePercentPercentIncrease, StringFormat='ðŸ‘†{0:0.##}%'}" />
                                    </VerticalStackLayout>
                                </DataTemplate>
                            </table:DataGridTemplateColumn.CellTemplate>
                        </table:DataGridTemplateColumn>
                    </table:SfDataGrid.Columns>

                    <table:SfDataGrid.SortColumnDescriptions>
                        <table:SortColumnDescription ColumnName="CoveragePercentPercentIncrease" SortDirection="Descending" />
                    </table:SfDataGrid.SortColumnDescriptions>

                    <table:SfDataGrid.SortIconTemplate>
                        <DataTemplate>
                            <Image HeightRequest="0" WidthRequest="0" />
                        </DataTemplate>
                    </table:SfDataGrid.SortIconTemplate>

                </table:SfDataGrid>
            </VerticalStackLayout>


            <VerticalStackLayout Grid.Column="1" Padding="5">
                <Label
                    FontSize="Large"
                    HorizontalOptions="Center"
                    Text="Complex Methods ðŸ˜µâ€ðŸ’«ðŸ˜µâ€ðŸ’«ðŸ˜µâ€ðŸ’«" />
                <table:SfDataGrid
                    Grid.Column="0"
                    AutoGenerateColumnsMode="None"
                    ColumnWidthMode="Fill"
                    HorizontalOptions="Fill"
                    ItemsSource="{Binding LatestData.ComplexMethods}"
                    RowHeight="43">
                    <table:SfDataGrid.Columns>
                        <table:DataGridTextColumn HeaderText="Method Name" MappingName="Name" />
                        <table:DataGridNumericColumn HeaderText="Complexity" MappingName="Complexity" />
                    </table:SfDataGrid.Columns>

                    <table:SfDataGrid.SortColumnDescriptions>
                        <table:SortColumnDescription ColumnName="Complexity" SortDirection="Descending" />
                    </table:SfDataGrid.SortColumnDescriptions>

                    <table:SfDataGrid.DefaultStyle>
                        <table:DataGridStyle
                            AlternateRowBackground="White"
                            HeaderRowBackground="#d3d3d3"
                            HeaderRowFontSize="20"
                            RowBackground="#e6e6e6" />
                    </table:SfDataGrid.DefaultStyle>

                    <table:SfDataGrid.SortIconTemplate>
                        <DataTemplate>
                            <Image HeightRequest="0" WidthRequest="0" />
                        </DataTemplate>
                    </table:SfDataGrid.SortIconTemplate>
                </table:SfDataGrid>
            </VerticalStackLayout>

        </Grid>
        <Grid
            Grid.Row="2"
            ColumnDefinitions="*, *, *, Auto"
            RowDefinitions="*">

            <Grid Grid.Column="0" RowDefinitions="*, auto">
                <progressBar:SfCircularProgressBar
                    Grid.Row="0"
                    BackgroundColor="Transparent"
                    HorizontalOptions="Fill"
                    Maximum="1"
                    Minimum="0"
                    Progress="{Binding LatestData.AverageLineCoveragePercent}"
                    ProgressThickness="20"
                    TrackThickness="20">
                    <progressBar:SfCircularProgressBar.Content>
                        <VerticalStackLayout>
                            <Label
                                FontSize="Large"
                                HorizontalOptions="Center"
                                Text="{Binding LatestData.AverageLineCoveragePercent, StringFormat='{0:0.##}%'}"
                                VerticalOptions="Center" />
                            <Label
                                FontSize="Medium"
                                HorizontalOptions="Center"
                                Text="{Binding LatestData.TotalLinesCoveredCount, StringFormat='({0})'}"
                                VerticalOptions="Center" />

                        </VerticalStackLayout>
                    </progressBar:SfCircularProgressBar.Content>

                    <progressBar:SfCircularProgressBar.GradientStops>
                        <progressBar:ProgressGradientStop Color="Red" Value="0" />
                        <progressBar:ProgressGradientStop Color="Orange" Value="0.2" />
                        <progressBar:ProgressGradientStop Color="Yellow" Value="0.6" />


                        <progressBar:ProgressGradientStop Color="Green" Value="0.8" />
                    </progressBar:SfCircularProgressBar.GradientStops>
                </progressBar:SfCircularProgressBar>
                <Label
                    Grid.Row="1"
                    FontSize="Medium"
                    HorizontalOptions="Center"
                    Text="Line Coverage" />

            </Grid>

            <Grid Grid.Column="1" RowDefinitions="*, auto">
                <progressBar:SfCircularProgressBar
                    Grid.Row="0"
                    BackgroundColor="Transparent"
                    HorizontalOptions="Fill"
                    Maximum="1"
                    Minimum="0"
                    Progress="{Binding LatestData.AverageBranchCoveragePercent}"
                    ProgressThickness="20"
                    TrackThickness="20">
                    <progressBar:SfCircularProgressBar.Content>
                        <VerticalStackLayout>
                            <Label
                                FontSize="Large"
                                HorizontalOptions="Center"
                                Text="{Binding LatestData.AverageBranchCoveragePercent, StringFormat='{0:0.##}%'}"
                                VerticalOptions="Center" />
                            <Label
                                FontSize="Medium"
                                HorizontalOptions="Center"
                                Text="{Binding LatestData.TotalBracnhesCoveredCount, StringFormat='({0})'}"
                                VerticalOptions="Center" />

                        </VerticalStackLayout>
                    </progressBar:SfCircularProgressBar.Content>

                    <progressBar:SfCircularProgressBar.GradientStops>
                        <progressBar:ProgressGradientStop Color="Red" Value="0" />
                        <progressBar:ProgressGradientStop Color="Orange" Value="0.2" />
                        <progressBar:ProgressGradientStop Color="Yellow" Value="0.6" />
                        <progressBar:ProgressGradientStop Color="Green" Value="0.8" />
                    </progressBar:SfCircularProgressBar.GradientStops>
                </progressBar:SfCircularProgressBar>
                <Label
                    Grid.Row="1"
                    FontSize="Medium"
                    HorizontalOptions="Center"
                    Text="Branch Coverage" />

            </Grid>

            <Grid Grid.Column="2" RowDefinitions="*, auto">
                <progressBar:SfCircularProgressBar
                    Grid.Row="0"
                    BackgroundColor="Transparent"
                    HorizontalOptions="Fill"
                    Maximum="1"
                    Minimum="0"
                    Progress="{Binding LatestData.AverageComplexMethodPercent}"
                    ProgressThickness="20"
                    TrackThickness="20">
                    <progressBar:SfCircularProgressBar.Content>
                        <VerticalStackLayout>
                            <Label
                                FontSize="Large"
                                HorizontalOptions="Center"
                                Text="{Binding LatestData.AverageComplexMethodPercent, StringFormat='{0:0.##}%'}"
                                VerticalOptions="Center" />
                            <Label
                                FontSize="Medium"
                                HorizontalOptions="Center"
                                Text="{Binding LatestData.ComplexMethods.Count, StringFormat='({0})'}"
                                VerticalOptions="Center" />

                        </VerticalStackLayout>
                    </progressBar:SfCircularProgressBar.Content>

                    <progressBar:SfCircularProgressBar.GradientStops>
                        <progressBar:ProgressGradientStop Color="Red" Value="0" />
                        <progressBar:ProgressGradientStop Color="Orange" Value="0.2" />
                        <progressBar:ProgressGradientStop Color="Yellow" Value="0.6" />
                        <progressBar:ProgressGradientStop Color="Green" Value="0.8" />
                    </progressBar:SfCircularProgressBar.GradientStops>
                </progressBar:SfCircularProgressBar>
                <Label
                    Grid.Row="1"
                    FontSize="Medium"
                    HorizontalOptions="Center"
                    Text="Complex Methods" />

            </Grid>


            <VerticalStackLayout
                Grid.Column="3"
                HorizontalOptions="Center"
                VerticalOptions="Center">
                <HorizontalStackLayout Grid.Column="2">
                    <Button
                        Command="{Binding GoToMainPageCommand}"
                        HeightRequest="25"
                        WidthRequest="25"
                        ZIndex="1" />
                    <Label
                        BackgroundColor="White"
                        FontSize="20"
                        HeightRequest="30"
                        HorizontalOptions="Start"
                        HorizontalTextAlignment="Center"
                        Text="Switch"
                        VerticalTextAlignment="Center"
                        ZIndex="1" />
                </HorizontalStackLayout>
                <Button
                    Grid.Row="2"
                    Grid.Column="2"
                    Command="{Binding GetRepoDataCommand}"
                    HeightRequest="100"
                    Text="Load Data"
                    WidthRequest="200" />
            </VerticalStackLayout>
        </Grid>

    </Grid>
</ContentPage>